ERROR - 2025-06-16 07:55:49 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ', COALESCE(
                  SUM(
                    CASE
                 ' at line 15 in C:\wamp64\www\khm\system\Database\MySQLi\Connection.php:312
Stack trace:
#0 C:\wamp64\www\khm\system\Database\MySQLi\Connection.php(312): mysqli->query('\r\n            S...', 0)
#1 C:\wamp64\www\khm\system\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('\r\n            S...')
#2 C:\wamp64\www\khm\system\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('\r\n            S...')
#3 C:\wamp64\www\khm\app\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('\r\n            S...')
#4 C:\wamp64\www\khm\app\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
#5 C:\wamp64\www\khm\system\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
#6 C:\wamp64\www\khm\system\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
#7 C:\wamp64\www\khm\system\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#8 C:\wamp64\www\khm\system\Boot.php(334): CodeIgniter\CodeIgniter->run()
#9 C:\wamp64\www\khm\system\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#10 C:\wamp64\www\khm\public\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#11 {main}
CRITICAL - 2025-06-16 07:55:49 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ', COALESCE(
                  SUM(
                    CASE
                 ' at line 15
[Method: GET, Route: PurchaseReport]
in SYSTEMPATH\Database\BaseConnection.php on line 688.
 1 APPPATH\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`., COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 2 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 3 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 4 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 5 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 6 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 7 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
 8 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 07:55:49 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ', COALESCE(
                  SUM(
                    CASE
                 ' at line 15
in SYSTEMPATH\Database\MySQLi\Connection.php on line 317.
 1 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`., COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 2 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`., COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 3 APPPATH\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`., COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 4 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 5 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 6 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 7 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 8 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 9 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
10 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 07:55:49 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ', COALESCE(
                  SUM(
                    CASE
                 ' at line 15
in SYSTEMPATH\Database\MySQLi\Connection.php on line 312.
 1 SYSTEMPATH\Database\MySQLi\Connection.php(312): mysqli->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`., COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ', 0)
 2 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`., COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 3 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`., COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 4 APPPATH\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`., COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 5 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 6 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 7 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 8 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2025-06-16 07:55:51 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ', COALESCE(
                  SUM(
                    CASE
                 ' at line 15 in C:\wamp64\www\khm\system\Database\MySQLi\Connection.php:312
Stack trace:
#0 C:\wamp64\www\khm\system\Database\MySQLi\Connection.php(312): mysqli->query('\r\n            S...', 0)
#1 C:\wamp64\www\khm\system\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('\r\n            S...')
#2 C:\wamp64\www\khm\system\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('\r\n            S...')
#3 C:\wamp64\www\khm\app\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('\r\n            S...')
#4 C:\wamp64\www\khm\app\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
#5 C:\wamp64\www\khm\system\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
#6 C:\wamp64\www\khm\system\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
#7 C:\wamp64\www\khm\system\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#8 C:\wamp64\www\khm\system\Boot.php(334): CodeIgniter\CodeIgniter->run()
#9 C:\wamp64\www\khm\system\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#10 C:\wamp64\www\khm\public\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#11 {main}
CRITICAL - 2025-06-16 07:55:51 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ', COALESCE(
                  SUM(
                    CASE
                 ' at line 15
[Method: GET, Route: PurchaseReport]
in SYSTEMPATH\Database\BaseConnection.php on line 688.
 1 APPPATH\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`., COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 2 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 3 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 4 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 5 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 6 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 7 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
 8 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 07:55:51 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ', COALESCE(
                  SUM(
                    CASE
                 ' at line 15
in SYSTEMPATH\Database\MySQLi\Connection.php on line 317.
 1 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`., COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 2 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`., COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 3 APPPATH\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`., COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 4 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 5 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 6 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 7 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 8 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 9 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
10 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 07:55:51 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ', COALESCE(
                  SUM(
                    CASE
                 ' at line 15
in SYSTEMPATH\Database\MySQLi\Connection.php on line 312.
 1 SYSTEMPATH\Database\MySQLi\Connection.php(312): mysqli->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`., COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ', 0)
 2 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`., COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 3 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`., COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 4 APPPATH\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`., COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 5 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 6 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 7 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 8 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2025-06-16 07:55:52 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ', COALESCE(
                  SUM(
                    CASE
                 ' at line 15 in C:\wamp64\www\khm\system\Database\MySQLi\Connection.php:312
Stack trace:
#0 C:\wamp64\www\khm\system\Database\MySQLi\Connection.php(312): mysqli->query('\r\n            S...', 0)
#1 C:\wamp64\www\khm\system\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('\r\n            S...')
#2 C:\wamp64\www\khm\system\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('\r\n            S...')
#3 C:\wamp64\www\khm\app\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('\r\n            S...')
#4 C:\wamp64\www\khm\app\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
#5 C:\wamp64\www\khm\system\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
#6 C:\wamp64\www\khm\system\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
#7 C:\wamp64\www\khm\system\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#8 C:\wamp64\www\khm\system\Boot.php(334): CodeIgniter\CodeIgniter->run()
#9 C:\wamp64\www\khm\system\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#10 C:\wamp64\www\khm\public\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#11 {main}
CRITICAL - 2025-06-16 07:55:52 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ', COALESCE(
                  SUM(
                    CASE
                 ' at line 15
[Method: GET, Route: PurchaseReport]
in SYSTEMPATH\Database\BaseConnection.php on line 688.
 1 APPPATH\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`., COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 2 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 3 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 4 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 5 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 6 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 7 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
 8 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 07:55:52 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ', COALESCE(
                  SUM(
                    CASE
                 ' at line 15
in SYSTEMPATH\Database\MySQLi\Connection.php on line 317.
 1 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`., COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 2 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`., COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 3 APPPATH\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`., COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 4 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 5 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 6 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 7 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 8 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 9 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
10 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 07:55:52 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ', COALESCE(
                  SUM(
                    CASE
                 ' at line 15
in SYSTEMPATH\Database\MySQLi\Connection.php on line 312.
 1 SYSTEMPATH\Database\MySQLi\Connection.php(312): mysqli->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`., COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ', 0)
 2 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`., COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 3 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`., COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 4 APPPATH\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`., COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 5 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 6 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 7 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 8 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2025-06-16 07:55:52 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ', COALESCE(
                  SUM(
                    CASE
                 ' at line 15 in C:\wamp64\www\khm\system\Database\MySQLi\Connection.php:312
Stack trace:
#0 C:\wamp64\www\khm\system\Database\MySQLi\Connection.php(312): mysqli->query('\r\n            S...', 0)
#1 C:\wamp64\www\khm\system\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('\r\n            S...')
#2 C:\wamp64\www\khm\system\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('\r\n            S...')
#3 C:\wamp64\www\khm\app\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('\r\n            S...')
#4 C:\wamp64\www\khm\app\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
#5 C:\wamp64\www\khm\system\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
#6 C:\wamp64\www\khm\system\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
#7 C:\wamp64\www\khm\system\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#8 C:\wamp64\www\khm\system\Boot.php(334): CodeIgniter\CodeIgniter->run()
#9 C:\wamp64\www\khm\system\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#10 C:\wamp64\www\khm\public\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#11 {main}
CRITICAL - 2025-06-16 07:55:52 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ', COALESCE(
                  SUM(
                    CASE
                 ' at line 15
[Method: GET, Route: PurchaseReport]
in SYSTEMPATH\Database\BaseConnection.php on line 688.
 1 APPPATH\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`., COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 2 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 3 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 4 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 5 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 6 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 7 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
 8 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 07:55:52 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ', COALESCE(
                  SUM(
                    CASE
                 ' at line 15
in SYSTEMPATH\Database\MySQLi\Connection.php on line 317.
 1 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`., COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 2 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`., COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 3 APPPATH\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`., COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 4 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 5 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 6 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 7 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 8 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 9 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
10 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 07:55:52 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ', COALESCE(
                  SUM(
                    CASE
                 ' at line 15
in SYSTEMPATH\Database\MySQLi\Connection.php on line 312.
 1 SYSTEMPATH\Database\MySQLi\Connection.php(312): mysqli->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`., COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ', 0)
 2 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`., COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 3 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`., COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 4 APPPATH\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`., COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 5 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 6 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 7 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 8 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2025-06-16 07:55:58 --> mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ', COALESCE(
                  SUM(
                    CASE
                 ' at line 15 in C:\wamp64\www\khm\system\Database\MySQLi\Connection.php:312
Stack trace:
#0 C:\wamp64\www\khm\system\Database\MySQLi\Connection.php(312): mysqli->query('\r\n            S...', 0)
#1 C:\wamp64\www\khm\system\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('\r\n            S...')
#2 C:\wamp64\www\khm\system\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('\r\n            S...')
#3 C:\wamp64\www\khm\app\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('\r\n            S...')
#4 C:\wamp64\www\khm\app\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
#5 C:\wamp64\www\khm\system\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
#6 C:\wamp64\www\khm\system\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
#7 C:\wamp64\www\khm\system\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#8 C:\wamp64\www\khm\system\Boot.php(334): CodeIgniter\CodeIgniter->run()
#9 C:\wamp64\www\khm\system\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#10 C:\wamp64\www\khm\public\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#11 {main}
CRITICAL - 2025-06-16 07:55:58 --> CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ', COALESCE(
                  SUM(
                    CASE
                 ' at line 15
[Method: GET, Route: PurchaseReport]
in SYSTEMPATH\Database\BaseConnection.php on line 688.
 1 APPPATH\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`., COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 2 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 3 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 4 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 5 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 6 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 7 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
 8 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 07:55:58 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ', COALESCE(
                  SUM(
                    CASE
                 ' at line 15
in SYSTEMPATH\Database\MySQLi\Connection.php on line 317.
 1 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`., COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 2 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`., COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 3 APPPATH\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`., COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 4 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 5 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 6 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 7 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 8 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 9 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
10 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 07:55:58 --> [Caused by] mysqli_sql_exception: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ', COALESCE(
                  SUM(
                    CASE
                 ' at line 15
in SYSTEMPATH\Database\MySQLi\Connection.php on line 312.
 1 SYSTEMPATH\Database\MySQLi\Connection.php(312): mysqli->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`., COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ', 0)
 2 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`., COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 3 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`., COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 4 APPPATH\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`., COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 5 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 6 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 7 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 8 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2025-06-16 07:56:44 --> mysqli_sql_exception: Unknown column 'koie.itinerary_details_id' in 'field list' in C:\wamp64\www\khm\system\Database\MySQLi\Connection.php:312
Stack trace:
#0 C:\wamp64\www\khm\system\Database\MySQLi\Connection.php(312): mysqli->query('\r\n            S...', 0)
#1 C:\wamp64\www\khm\system\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('\r\n            S...')
#2 C:\wamp64\www\khm\system\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('\r\n            S...')
#3 C:\wamp64\www\khm\app\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('\r\n            S...')
#4 C:\wamp64\www\khm\app\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
#5 C:\wamp64\www\khm\system\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
#6 C:\wamp64\www\khm\system\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
#7 C:\wamp64\www\khm\system\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#8 C:\wamp64\www\khm\system\Boot.php(334): CodeIgniter\CodeIgniter->run()
#9 C:\wamp64\www\khm\system\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#10 C:\wamp64\www\khm\public\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#11 {main}
CRITICAL - 2025-06-16 07:56:44 --> CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'koie.itinerary_details_id' in 'field list'
[Method: GET, Route: PurchaseReport]
in SYSTEMPATH\Database\BaseConnection.php on line 688.
 1 APPPATH\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 2 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 3 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 4 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 5 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 6 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 7 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
 8 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 07:56:44 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'koie.itinerary_details_id' in 'field list'
in SYSTEMPATH\Database\MySQLi\Connection.php on line 317.
 1 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 2 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 3 APPPATH\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 4 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 5 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 6 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 7 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 8 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 9 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
10 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 07:56:44 --> [Caused by] mysqli_sql_exception: Unknown column 'koie.itinerary_details_id' in 'field list'
in SYSTEMPATH\Database\MySQLi\Connection.php on line 312.
 1 SYSTEMPATH\Database\MySQLi\Connection.php(312): mysqli->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ', 0)
 2 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 3 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 4 APPPATH\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 5 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 6 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 7 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 8 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2025-06-16 07:56:46 --> mysqli_sql_exception: Unknown column 'koie.itinerary_details_id' in 'field list' in C:\wamp64\www\khm\system\Database\MySQLi\Connection.php:312
Stack trace:
#0 C:\wamp64\www\khm\system\Database\MySQLi\Connection.php(312): mysqli->query('\r\n            S...', 0)
#1 C:\wamp64\www\khm\system\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('\r\n            S...')
#2 C:\wamp64\www\khm\system\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('\r\n            S...')
#3 C:\wamp64\www\khm\app\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('\r\n            S...')
#4 C:\wamp64\www\khm\app\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
#5 C:\wamp64\www\khm\system\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
#6 C:\wamp64\www\khm\system\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
#7 C:\wamp64\www\khm\system\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#8 C:\wamp64\www\khm\system\Boot.php(334): CodeIgniter\CodeIgniter->run()
#9 C:\wamp64\www\khm\system\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#10 C:\wamp64\www\khm\public\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#11 {main}
CRITICAL - 2025-06-16 07:56:46 --> CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'koie.itinerary_details_id' in 'field list'
[Method: GET, Route: PurchaseReport]
in SYSTEMPATH\Database\BaseConnection.php on line 688.
 1 APPPATH\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 2 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 3 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 4 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 5 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 6 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 7 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
 8 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 07:56:46 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'koie.itinerary_details_id' in 'field list'
in SYSTEMPATH\Database\MySQLi\Connection.php on line 317.
 1 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 2 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 3 APPPATH\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 4 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 5 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 6 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 7 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 8 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 9 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
10 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 07:56:46 --> [Caused by] mysqli_sql_exception: Unknown column 'koie.itinerary_details_id' in 'field list'
in SYSTEMPATH\Database\MySQLi\Connection.php on line 312.
 1 SYSTEMPATH\Database\MySQLi\Connection.php(312): mysqli->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ', 0)
 2 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 3 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 4 APPPATH\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 5 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 6 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 7 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 8 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2025-06-16 07:56:46 --> mysqli_sql_exception: Unknown column 'koie.itinerary_details_id' in 'field list' in C:\wamp64\www\khm\system\Database\MySQLi\Connection.php:312
Stack trace:
#0 C:\wamp64\www\khm\system\Database\MySQLi\Connection.php(312): mysqli->query('\r\n            S...', 0)
#1 C:\wamp64\www\khm\system\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('\r\n            S...')
#2 C:\wamp64\www\khm\system\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('\r\n            S...')
#3 C:\wamp64\www\khm\app\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('\r\n            S...')
#4 C:\wamp64\www\khm\app\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
#5 C:\wamp64\www\khm\system\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
#6 C:\wamp64\www\khm\system\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
#7 C:\wamp64\www\khm\system\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#8 C:\wamp64\www\khm\system\Boot.php(334): CodeIgniter\CodeIgniter->run()
#9 C:\wamp64\www\khm\system\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#10 C:\wamp64\www\khm\public\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#11 {main}
CRITICAL - 2025-06-16 07:56:46 --> CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'koie.itinerary_details_id' in 'field list'
[Method: GET, Route: PurchaseReport]
in SYSTEMPATH\Database\BaseConnection.php on line 688.
 1 APPPATH\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 2 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 3 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 4 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 5 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 6 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 7 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
 8 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 07:56:46 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'koie.itinerary_details_id' in 'field list'
in SYSTEMPATH\Database\MySQLi\Connection.php on line 317.
 1 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 2 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 3 APPPATH\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 4 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 5 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 6 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 7 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 8 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 9 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
10 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 07:56:46 --> [Caused by] mysqli_sql_exception: Unknown column 'koie.itinerary_details_id' in 'field list'
in SYSTEMPATH\Database\MySQLi\Connection.php on line 312.
 1 SYSTEMPATH\Database\MySQLi\Connection.php(312): mysqli->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ', 0)
 2 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 3 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 4 APPPATH\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 5 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 6 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 7 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 8 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2025-06-16 07:56:47 --> mysqli_sql_exception: Unknown column 'koie.itinerary_details_id' in 'field list' in C:\wamp64\www\khm\system\Database\MySQLi\Connection.php:312
Stack trace:
#0 C:\wamp64\www\khm\system\Database\MySQLi\Connection.php(312): mysqli->query('\r\n            S...', 0)
#1 C:\wamp64\www\khm\system\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('\r\n            S...')
#2 C:\wamp64\www\khm\system\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('\r\n            S...')
#3 C:\wamp64\www\khm\app\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('\r\n            S...')
#4 C:\wamp64\www\khm\app\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
#5 C:\wamp64\www\khm\system\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
#6 C:\wamp64\www\khm\system\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
#7 C:\wamp64\www\khm\system\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#8 C:\wamp64\www\khm\system\Boot.php(334): CodeIgniter\CodeIgniter->run()
#9 C:\wamp64\www\khm\system\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#10 C:\wamp64\www\khm\public\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#11 {main}
CRITICAL - 2025-06-16 07:56:47 --> CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'koie.itinerary_details_id' in 'field list'
[Method: GET, Route: PurchaseReport]
in SYSTEMPATH\Database\BaseConnection.php on line 688.
 1 APPPATH\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 2 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 3 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 4 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 5 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 6 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 7 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
 8 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 07:56:47 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'koie.itinerary_details_id' in 'field list'
in SYSTEMPATH\Database\MySQLi\Connection.php on line 317.
 1 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 2 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 3 APPPATH\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 4 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 5 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 6 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 7 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 8 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 9 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
10 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 07:56:47 --> [Caused by] mysqli_sql_exception: Unknown column 'koie.itinerary_details_id' in 'field list'
in SYSTEMPATH\Database\MySQLi\Connection.php on line 312.
 1 SYSTEMPATH\Database\MySQLi\Connection.php(312): mysqli->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ', 0)
 2 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 3 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 4 APPPATH\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 5 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 6 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 7 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 8 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2025-06-16 07:56:47 --> mysqli_sql_exception: Unknown column 'koie.itinerary_details_id' in 'field list' in C:\wamp64\www\khm\system\Database\MySQLi\Connection.php:312
Stack trace:
#0 C:\wamp64\www\khm\system\Database\MySQLi\Connection.php(312): mysqli->query('\r\n            S...', 0)
#1 C:\wamp64\www\khm\system\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('\r\n            S...')
#2 C:\wamp64\www\khm\system\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('\r\n            S...')
#3 C:\wamp64\www\khm\app\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('\r\n            S...')
#4 C:\wamp64\www\khm\app\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
#5 C:\wamp64\www\khm\system\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
#6 C:\wamp64\www\khm\system\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
#7 C:\wamp64\www\khm\system\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#8 C:\wamp64\www\khm\system\Boot.php(334): CodeIgniter\CodeIgniter->run()
#9 C:\wamp64\www\khm\system\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#10 C:\wamp64\www\khm\public\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#11 {main}
CRITICAL - 2025-06-16 07:56:47 --> CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'koie.itinerary_details_id' in 'field list'
[Method: GET, Route: PurchaseReport]
in SYSTEMPATH\Database\BaseConnection.php on line 688.
 1 APPPATH\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 2 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 3 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 4 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 5 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 6 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 7 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
 8 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 07:56:47 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'koie.itinerary_details_id' in 'field list'
in SYSTEMPATH\Database\MySQLi\Connection.php on line 317.
 1 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 2 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 3 APPPATH\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 4 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 5 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 6 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 7 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 8 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 9 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
10 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 07:56:47 --> [Caused by] mysqli_sql_exception: Unknown column 'koie.itinerary_details_id' in 'field list'
in SYSTEMPATH\Database\MySQLi\Connection.php on line 312.
 1 SYSTEMPATH\Database\MySQLi\Connection.php(312): mysqli->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ', 0)
 2 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 3 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 4 APPPATH\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 5 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 6 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 7 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 8 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2025-06-16 07:56:48 --> mysqli_sql_exception: Unknown column 'koie.itinerary_details_id' in 'field list' in C:\wamp64\www\khm\system\Database\MySQLi\Connection.php:312
Stack trace:
#0 C:\wamp64\www\khm\system\Database\MySQLi\Connection.php(312): mysqli->query('\r\n            S...', 0)
#1 C:\wamp64\www\khm\system\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('\r\n            S...')
#2 C:\wamp64\www\khm\system\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('\r\n            S...')
#3 C:\wamp64\www\khm\app\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('\r\n            S...')
#4 C:\wamp64\www\khm\app\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
#5 C:\wamp64\www\khm\system\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
#6 C:\wamp64\www\khm\system\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
#7 C:\wamp64\www\khm\system\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#8 C:\wamp64\www\khm\system\Boot.php(334): CodeIgniter\CodeIgniter->run()
#9 C:\wamp64\www\khm\system\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#10 C:\wamp64\www\khm\public\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#11 {main}
CRITICAL - 2025-06-16 07:56:48 --> CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'koie.itinerary_details_id' in 'field list'
[Method: GET, Route: PurchaseReport]
in SYSTEMPATH\Database\BaseConnection.php on line 688.
 1 APPPATH\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 2 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 3 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 4 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 5 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 6 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 7 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
 8 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 07:56:48 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'koie.itinerary_details_id' in 'field list'
in SYSTEMPATH\Database\MySQLi\Connection.php on line 317.
 1 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 2 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 3 APPPATH\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 4 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 5 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 6 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 7 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 8 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 9 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
10 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 07:56:48 --> [Caused by] mysqli_sql_exception: Unknown column 'koie.itinerary_details_id' in 'field list'
in SYSTEMPATH\Database\MySQLi\Connection.php on line 312.
 1 SYSTEMPATH\Database\MySQLi\Connection.php(312): mysqli->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ', 0)
 2 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 3 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 4 APPPATH\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 5 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 6 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 7 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 8 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2025-06-16 07:56:48 --> mysqli_sql_exception: Unknown column 'koie.itinerary_details_id' in 'field list' in C:\wamp64\www\khm\system\Database\MySQLi\Connection.php:312
Stack trace:
#0 C:\wamp64\www\khm\system\Database\MySQLi\Connection.php(312): mysqli->query('\r\n            S...', 0)
#1 C:\wamp64\www\khm\system\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('\r\n            S...')
#2 C:\wamp64\www\khm\system\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('\r\n            S...')
#3 C:\wamp64\www\khm\app\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('\r\n            S...')
#4 C:\wamp64\www\khm\app\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
#5 C:\wamp64\www\khm\system\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
#6 C:\wamp64\www\khm\system\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
#7 C:\wamp64\www\khm\system\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#8 C:\wamp64\www\khm\system\Boot.php(334): CodeIgniter\CodeIgniter->run()
#9 C:\wamp64\www\khm\system\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#10 C:\wamp64\www\khm\public\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#11 {main}
CRITICAL - 2025-06-16 07:56:48 --> CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'koie.itinerary_details_id' in 'field list'
[Method: GET, Route: PurchaseReport]
in SYSTEMPATH\Database\BaseConnection.php on line 688.
 1 APPPATH\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 2 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 3 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 4 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 5 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 6 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 7 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
 8 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 07:56:48 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'koie.itinerary_details_id' in 'field list'
in SYSTEMPATH\Database\MySQLi\Connection.php on line 317.
 1 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 2 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 3 APPPATH\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 4 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 5 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 6 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 7 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 8 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 9 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
10 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 07:56:48 --> [Caused by] mysqli_sql_exception: Unknown column 'koie.itinerary_details_id' in 'field list'
in SYSTEMPATH\Database\MySQLi\Connection.php on line 312.
 1 SYSTEMPATH\Database\MySQLi\Connection.php(312): mysqli->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ', 0)
 2 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 3 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 4 APPPATH\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 5 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 6 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 7 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 8 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2025-06-16 07:56:50 --> mysqli_sql_exception: Unknown column 'koie.itinerary_details_id' in 'field list' in C:\wamp64\www\khm\system\Database\MySQLi\Connection.php:312
Stack trace:
#0 C:\wamp64\www\khm\system\Database\MySQLi\Connection.php(312): mysqli->query('\r\n            S...', 0)
#1 C:\wamp64\www\khm\system\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('\r\n            S...')
#2 C:\wamp64\www\khm\system\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('\r\n            S...')
#3 C:\wamp64\www\khm\app\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('\r\n            S...')
#4 C:\wamp64\www\khm\app\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
#5 C:\wamp64\www\khm\system\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
#6 C:\wamp64\www\khm\system\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
#7 C:\wamp64\www\khm\system\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#8 C:\wamp64\www\khm\system\Boot.php(334): CodeIgniter\CodeIgniter->run()
#9 C:\wamp64\www\khm\system\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#10 C:\wamp64\www\khm\public\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#11 {main}
CRITICAL - 2025-06-16 07:56:50 --> CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'koie.itinerary_details_id' in 'field list'
[Method: GET, Route: PurchaseReport]
in SYSTEMPATH\Database\BaseConnection.php on line 688.
 1 APPPATH\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 2 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 3 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 4 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 5 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 6 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 7 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
 8 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 07:56:50 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'koie.itinerary_details_id' in 'field list'
in SYSTEMPATH\Database\MySQLi\Connection.php on line 317.
 1 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 2 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 3 APPPATH\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 4 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 5 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 6 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 7 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 8 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 9 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
10 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 07:56:50 --> [Caused by] mysqli_sql_exception: Unknown column 'koie.itinerary_details_id' in 'field list'
in SYSTEMPATH\Database\MySQLi\Connection.php on line 312.
 1 SYSTEMPATH\Database\MySQLi\Connection.php(312): mysqli->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ', 0)
 2 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 3 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 4 APPPATH\Models\PurchaseReportModel.php(265): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koie`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `t`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_header_id` = `h`.`enquiry_header_id` AND `e`.`enquiry_details_id` = `d`.`enquiry_details_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`itinerary_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 5 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 6 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 7 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 8 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2025-06-16 09:38:29 --> mysqli_sql_exception: Unknown column 'e.tour_plan_ref_id' in 'on clause' in C:\wamp64\www\khm\system\Database\MySQLi\Connection.php:312
Stack trace:
#0 C:\wamp64\www\khm\system\Database\MySQLi\Connection.php(312): mysqli->query('\r\n            S...', 0)
#1 C:\wamp64\www\khm\system\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('\r\n            S...')
#2 C:\wamp64\www\khm\system\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('\r\n            S...')
#3 C:\wamp64\www\khm\app\Models\PurchaseReportModel.php(318): CodeIgniter\Database\BaseConnection->query('\r\n            S...', Array)
#4 C:\wamp64\www\khm\app\Controllers\PurchaseReport.php(129): App\Models\PurchaseReportModel->getByDateRange('2025-06-03 00:0...', '2025-06-17 00:0...', 1, 3)
#5 C:\wamp64\www\khm\system\CodeIgniter.php(933): App\Controllers\PurchaseReport->data()
#6 C:\wamp64\www\khm\system\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
#7 C:\wamp64\www\khm\system\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#8 C:\wamp64\www\khm\system\Boot.php(334): CodeIgniter\CodeIgniter->run()
#9 C:\wamp64\www\khm\system\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#10 C:\wamp64\www\khm\public\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#11 {main}
CRITICAL - 2025-06-16 09:38:29 --> CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'e.tour_plan_ref_id' in 'on clause'
[Method: GET, Route: PurchaseReport/data]
in SYSTEMPATH\Database\BaseConnection.php on line 688.
 1 APPPATH\Models\PurchaseReportModel.php(318): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
            WHERE
                1 = 1
                 AND base.enq_type_id = ? 
                AND base.tour_date >= ?
                AND base.tour_date < ?
        ', [...])
 2 APPPATH\Controllers\PurchaseReport.php(129): App\Models\PurchaseReportModel->getByDateRange('2025-06-03 00:00:00', '2025-06-17 00:00:00', 1, 3)
 3 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->data()
 4 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 5 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 6 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 7 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
 8 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 09:38:29 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'e.tour_plan_ref_id' in 'on clause'
in SYSTEMPATH\Database\MySQLi\Connection.php on line 317.
 1 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
            WHERE
                1 = 1
                 AND base.enq_type_id = 3 
                AND base.tour_date >= \'2025-06-03 00:00:00\'
                AND base.tour_date < \'2025-06-17 00:00:00\'
        ')
 2 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
            WHERE
                1 = 1
                 AND base.enq_type_id = 3 
                AND base.tour_date >= \'2025-06-03 00:00:00\'
                AND base.tour_date < \'2025-06-17 00:00:00\'
        ')
 3 APPPATH\Models\PurchaseReportModel.php(318): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
            WHERE
                1 = 1
                 AND base.enq_type_id = ? 
                AND base.tour_date >= ?
                AND base.tour_date < ?
        ', [...])
 4 APPPATH\Controllers\PurchaseReport.php(129): App\Models\PurchaseReportModel->getByDateRange('2025-06-03 00:00:00', '2025-06-17 00:00:00', 1, 3)
 5 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->data()
 6 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 7 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 8 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 9 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
10 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 09:38:29 --> [Caused by] mysqli_sql_exception: Unknown column 'e.tour_plan_ref_id' in 'on clause'
in SYSTEMPATH\Database\MySQLi\Connection.php on line 312.
 1 SYSTEMPATH\Database\MySQLi\Connection.php(312): mysqli->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
            WHERE
                1 = 1
                 AND base.enq_type_id = 3 
                AND base.tour_date >= \'2025-06-03 00:00:00\'
                AND base.tour_date < \'2025-06-17 00:00:00\'
        ', 0)
 2 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
            WHERE
                1 = 1
                 AND base.enq_type_id = 3 
                AND base.tour_date >= \'2025-06-03 00:00:00\'
                AND base.tour_date < \'2025-06-17 00:00:00\'
        ')
 3 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
            WHERE
                1 = 1
                 AND base.enq_type_id = 3 
                AND base.tour_date >= \'2025-06-03 00:00:00\'
                AND base.tour_date < \'2025-06-17 00:00:00\'
        ')
 4 APPPATH\Models\PurchaseReportModel.php(318): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
            WHERE
                1 = 1
                 AND base.enq_type_id = ? 
                AND base.tour_date >= ?
                AND base.tour_date < ?
        ', [...])
 5 APPPATH\Controllers\PurchaseReport.php(129): App\Models\PurchaseReportModel->getByDateRange('2025-06-03 00:00:00', '2025-06-17 00:00:00', 1, 3)
 6 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->data()
 7 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 8 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2025-06-16 09:38:33 --> mysqli_sql_exception: Unknown column 'e.tour_plan_ref_id' in 'on clause' in C:\wamp64\www\khm\system\Database\MySQLi\Connection.php:312
Stack trace:
#0 C:\wamp64\www\khm\system\Database\MySQLi\Connection.php(312): mysqli->query('\r\n            S...', 0)
#1 C:\wamp64\www\khm\system\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('\r\n            S...')
#2 C:\wamp64\www\khm\system\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('\r\n            S...')
#3 C:\wamp64\www\khm\app\Models\PurchaseReportModel.php(318): CodeIgniter\Database\BaseConnection->query('\r\n            S...', Array)
#4 C:\wamp64\www\khm\app\Controllers\PurchaseReport.php(129): App\Models\PurchaseReportModel->getByDateRange('2025-06-03 00:0...', '2025-06-17 00:0...', 1, 3)
#5 C:\wamp64\www\khm\system\CodeIgniter.php(933): App\Controllers\PurchaseReport->data()
#6 C:\wamp64\www\khm\system\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
#7 C:\wamp64\www\khm\system\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#8 C:\wamp64\www\khm\system\Boot.php(334): CodeIgniter\CodeIgniter->run()
#9 C:\wamp64\www\khm\system\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#10 C:\wamp64\www\khm\public\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#11 {main}
CRITICAL - 2025-06-16 09:38:33 --> CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'e.tour_plan_ref_id' in 'on clause'
[Method: GET, Route: PurchaseReport/data]
in SYSTEMPATH\Database\BaseConnection.php on line 688.
 1 APPPATH\Models\PurchaseReportModel.php(318): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
            WHERE
                1 = 1
                 AND base.enq_type_id = ? 
                AND base.tour_date >= ?
                AND base.tour_date < ?
        ', [...])
 2 APPPATH\Controllers\PurchaseReport.php(129): App\Models\PurchaseReportModel->getByDateRange('2025-06-03 00:00:00', '2025-06-17 00:00:00', 1, 3)
 3 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->data()
 4 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 5 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 6 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 7 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
 8 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 09:38:33 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'e.tour_plan_ref_id' in 'on clause'
in SYSTEMPATH\Database\MySQLi\Connection.php on line 317.
 1 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
            WHERE
                1 = 1
                 AND base.enq_type_id = 3 
                AND base.tour_date >= \'2025-06-03 00:00:00\'
                AND base.tour_date < \'2025-06-17 00:00:00\'
        ')
 2 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
            WHERE
                1 = 1
                 AND base.enq_type_id = 3 
                AND base.tour_date >= \'2025-06-03 00:00:00\'
                AND base.tour_date < \'2025-06-17 00:00:00\'
        ')
 3 APPPATH\Models\PurchaseReportModel.php(318): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
            WHERE
                1 = 1
                 AND base.enq_type_id = ? 
                AND base.tour_date >= ?
                AND base.tour_date < ?
        ', [...])
 4 APPPATH\Controllers\PurchaseReport.php(129): App\Models\PurchaseReportModel->getByDateRange('2025-06-03 00:00:00', '2025-06-17 00:00:00', 1, 3)
 5 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->data()
 6 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 7 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 8 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 9 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
10 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 09:38:33 --> [Caused by] mysqli_sql_exception: Unknown column 'e.tour_plan_ref_id' in 'on clause'
in SYSTEMPATH\Database\MySQLi\Connection.php on line 312.
 1 SYSTEMPATH\Database\MySQLi\Connection.php(312): mysqli->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
            WHERE
                1 = 1
                 AND base.enq_type_id = 3 
                AND base.tour_date >= \'2025-06-03 00:00:00\'
                AND base.tour_date < \'2025-06-17 00:00:00\'
        ', 0)
 2 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
            WHERE
                1 = 1
                 AND base.enq_type_id = 3 
                AND base.tour_date >= \'2025-06-03 00:00:00\'
                AND base.tour_date < \'2025-06-17 00:00:00\'
        ')
 3 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
            WHERE
                1 = 1
                 AND base.enq_type_id = 3 
                AND base.tour_date >= \'2025-06-03 00:00:00\'
                AND base.tour_date < \'2025-06-17 00:00:00\'
        ')
 4 APPPATH\Models\PurchaseReportModel.php(318): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
            WHERE
                1 = 1
                 AND base.enq_type_id = ? 
                AND base.tour_date >= ?
                AND base.tour_date < ?
        ', [...])
 5 APPPATH\Controllers\PurchaseReport.php(129): App\Models\PurchaseReportModel->getByDateRange('2025-06-03 00:00:00', '2025-06-17 00:00:00', 1, 3)
 6 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->data()
 7 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 8 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2025-06-16 09:39:36 --> mysqli_sql_exception: Unknown column 'e.tour_plan_ref_id' in 'on clause' in C:\wamp64\www\khm\system\Database\MySQLi\Connection.php:312
Stack trace:
#0 C:\wamp64\www\khm\system\Database\MySQLi\Connection.php(312): mysqli->query('\r\n            S...', 0)
#1 C:\wamp64\www\khm\system\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('\r\n            S...')
#2 C:\wamp64\www\khm\system\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('\r\n            S...')
#3 C:\wamp64\www\khm\app\Models\PurchaseReportModel.php(318): CodeIgniter\Database\BaseConnection->query('\r\n            S...', Array)
#4 C:\wamp64\www\khm\app\Controllers\PurchaseReport.php(129): App\Models\PurchaseReportModel->getByDateRange('2025-06-03 00:0...', '2025-06-17 00:0...', 1, 3)
#5 C:\wamp64\www\khm\system\CodeIgniter.php(933): App\Controllers\PurchaseReport->data()
#6 C:\wamp64\www\khm\system\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
#7 C:\wamp64\www\khm\system\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#8 C:\wamp64\www\khm\system\Boot.php(334): CodeIgniter\CodeIgniter->run()
#9 C:\wamp64\www\khm\system\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#10 C:\wamp64\www\khm\public\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#11 {main}
CRITICAL - 2025-06-16 09:39:36 --> CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'e.tour_plan_ref_id' in 'on clause'
[Method: GET, Route: PurchaseReport/data]
in SYSTEMPATH\Database\BaseConnection.php on line 688.
 1 APPPATH\Models\PurchaseReportModel.php(318): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
            WHERE
                1 = 1
                 AND base.enq_type_id = ? 
                AND base.tour_date >= ?
                AND base.tour_date < ?
        ', [...])
 2 APPPATH\Controllers\PurchaseReport.php(129): App\Models\PurchaseReportModel->getByDateRange('2025-06-03 00:00:00', '2025-06-17 00:00:00', 1, 3)
 3 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->data()
 4 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 5 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 6 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 7 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
 8 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 09:39:36 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'e.tour_plan_ref_id' in 'on clause'
in SYSTEMPATH\Database\MySQLi\Connection.php on line 317.
 1 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
            WHERE
                1 = 1
                 AND base.enq_type_id = 3 
                AND base.tour_date >= \'2025-06-03 00:00:00\'
                AND base.tour_date < \'2025-06-17 00:00:00\'
        ')
 2 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
            WHERE
                1 = 1
                 AND base.enq_type_id = 3 
                AND base.tour_date >= \'2025-06-03 00:00:00\'
                AND base.tour_date < \'2025-06-17 00:00:00\'
        ')
 3 APPPATH\Models\PurchaseReportModel.php(318): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
            WHERE
                1 = 1
                 AND base.enq_type_id = ? 
                AND base.tour_date >= ?
                AND base.tour_date < ?
        ', [...])
 4 APPPATH\Controllers\PurchaseReport.php(129): App\Models\PurchaseReportModel->getByDateRange('2025-06-03 00:00:00', '2025-06-17 00:00:00', 1, 3)
 5 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->data()
 6 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 7 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 8 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 9 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
10 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 09:39:36 --> [Caused by] mysqli_sql_exception: Unknown column 'e.tour_plan_ref_id' in 'on clause'
in SYSTEMPATH\Database\MySQLi\Connection.php on line 312.
 1 SYSTEMPATH\Database\MySQLi\Connection.php(312): mysqli->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
            WHERE
                1 = 1
                 AND base.enq_type_id = 3 
                AND base.tour_date >= \'2025-06-03 00:00:00\'
                AND base.tour_date < \'2025-06-17 00:00:00\'
        ', 0)
 2 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
            WHERE
                1 = 1
                 AND base.enq_type_id = 3 
                AND base.tour_date >= \'2025-06-03 00:00:00\'
                AND base.tour_date < \'2025-06-17 00:00:00\'
        ')
 3 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
            WHERE
                1 = 1
                 AND base.enq_type_id = 3 
                AND base.tour_date >= \'2025-06-03 00:00:00\'
                AND base.tour_date < \'2025-06-17 00:00:00\'
        ')
 4 APPPATH\Models\PurchaseReportModel.php(318): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
            WHERE
                1 = 1
                 AND base.enq_type_id = ? 
                AND base.tour_date >= ?
                AND base.tour_date < ?
        ', [...])
 5 APPPATH\Controllers\PurchaseReport.php(129): App\Models\PurchaseReportModel->getByDateRange('2025-06-03 00:00:00', '2025-06-17 00:00:00', 1, 3)
 6 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->data()
 7 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 8 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2025-06-16 09:47:00 --> mysqli_sql_exception: Unknown column 'e.tour_plan_ref_id' in 'on clause' in C:\wamp64\www\khm\system\Database\MySQLi\Connection.php:312
Stack trace:
#0 C:\wamp64\www\khm\system\Database\MySQLi\Connection.php(312): mysqli->query('\r\n            S...', 0)
#1 C:\wamp64\www\khm\system\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('\r\n            S...')
#2 C:\wamp64\www\khm\system\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('\r\n            S...')
#3 C:\wamp64\www\khm\app\Models\PurchaseReportModel.php(314): CodeIgniter\Database\BaseConnection->query('\r\n            S...', Array)
#4 C:\wamp64\www\khm\app\Controllers\PurchaseReport.php(129): App\Models\PurchaseReportModel->getByDateRange('2025-06-16 00:0...', '2025-06-17 00:0...', 1, 3)
#5 C:\wamp64\www\khm\system\CodeIgniter.php(933): App\Controllers\PurchaseReport->data()
#6 C:\wamp64\www\khm\system\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
#7 C:\wamp64\www\khm\system\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#8 C:\wamp64\www\khm\system\Boot.php(334): CodeIgniter\CodeIgniter->run()
#9 C:\wamp64\www\khm\system\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#10 C:\wamp64\www\khm\public\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#11 {main}
CRITICAL - 2025-06-16 09:47:00 --> CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'e.tour_plan_ref_id' in 'on clause'
[Method: GET, Route: PurchaseReport/data]
in SYSTEMPATH\Database\BaseConnection.php on line 688.
 1 APPPATH\Models\PurchaseReportModel.php(314): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id`       = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
            WHERE
                1 = 1
                 AND base.enq_type_id = ? 
                AND base.tour_date >= ?
                AND base.tour_date < ?
        ', [...])
 2 APPPATH\Controllers\PurchaseReport.php(129): App\Models\PurchaseReportModel->getByDateRange('2025-06-16 00:00:00', '2025-06-17 00:00:00', 1, 3)
 3 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->data()
 4 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 5 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 6 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 7 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
 8 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 09:47:00 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'e.tour_plan_ref_id' in 'on clause'
in SYSTEMPATH\Database\MySQLi\Connection.php on line 317.
 1 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id`       = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
            WHERE
                1 = 1
                 AND base.enq_type_id = 3 
                AND base.tour_date >= \'2025-06-16 00:00:00\'
                AND base.tour_date < \'2025-06-17 00:00:00\'
        ')
 2 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id`       = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
            WHERE
                1 = 1
                 AND base.enq_type_id = 3 
                AND base.tour_date >= \'2025-06-16 00:00:00\'
                AND base.tour_date < \'2025-06-17 00:00:00\'
        ')
 3 APPPATH\Models\PurchaseReportModel.php(314): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id`       = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
            WHERE
                1 = 1
                 AND base.enq_type_id = ? 
                AND base.tour_date >= ?
                AND base.tour_date < ?
        ', [...])
 4 APPPATH\Controllers\PurchaseReport.php(129): App\Models\PurchaseReportModel->getByDateRange('2025-06-16 00:00:00', '2025-06-17 00:00:00', 1, 3)
 5 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->data()
 6 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 7 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 8 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 9 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
10 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 09:47:00 --> [Caused by] mysqli_sql_exception: Unknown column 'e.tour_plan_ref_id' in 'on clause'
in SYSTEMPATH\Database\MySQLi\Connection.php on line 312.
 1 SYSTEMPATH\Database\MySQLi\Connection.php(312): mysqli->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id`       = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
            WHERE
                1 = 1
                 AND base.enq_type_id = 3 
                AND base.tour_date >= \'2025-06-16 00:00:00\'
                AND base.tour_date < \'2025-06-17 00:00:00\'
        ', 0)
 2 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id`       = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
            WHERE
                1 = 1
                 AND base.enq_type_id = 3 
                AND base.tour_date >= \'2025-06-16 00:00:00\'
                AND base.tour_date < \'2025-06-17 00:00:00\'
        ')
 3 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id`       = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
            WHERE
                1 = 1
                 AND base.enq_type_id = 3 
                AND base.tour_date >= \'2025-06-16 00:00:00\'
                AND base.tour_date < \'2025-06-17 00:00:00\'
        ')
 4 APPPATH\Models\PurchaseReportModel.php(314): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id`       = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
            WHERE
                1 = 1
                 AND base.enq_type_id = ? 
                AND base.tour_date >= ?
                AND base.tour_date < ?
        ', [...])
 5 APPPATH\Controllers\PurchaseReport.php(129): App\Models\PurchaseReportModel->getByDateRange('2025-06-16 00:00:00', '2025-06-17 00:00:00', 1, 3)
 6 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->data()
 7 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 8 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2025-06-16 09:47:02 --> mysqli_sql_exception: Unknown column 'e.tour_plan_ref_id' in 'on clause' in C:\wamp64\www\khm\system\Database\MySQLi\Connection.php:312
Stack trace:
#0 C:\wamp64\www\khm\system\Database\MySQLi\Connection.php(312): mysqli->query('\r\n            S...', 0)
#1 C:\wamp64\www\khm\system\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('\r\n            S...')
#2 C:\wamp64\www\khm\system\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('\r\n            S...')
#3 C:\wamp64\www\khm\app\Models\PurchaseReportModel.php(314): CodeIgniter\Database\BaseConnection->query('\r\n            S...', Array)
#4 C:\wamp64\www\khm\app\Controllers\PurchaseReport.php(129): App\Models\PurchaseReportModel->getByDateRange('2025-06-16 00:0...', '2025-06-17 00:0...', 1, 3)
#5 C:\wamp64\www\khm\system\CodeIgniter.php(933): App\Controllers\PurchaseReport->data()
#6 C:\wamp64\www\khm\system\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
#7 C:\wamp64\www\khm\system\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#8 C:\wamp64\www\khm\system\Boot.php(334): CodeIgniter\CodeIgniter->run()
#9 C:\wamp64\www\khm\system\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#10 C:\wamp64\www\khm\public\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#11 {main}
CRITICAL - 2025-06-16 09:47:02 --> CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'e.tour_plan_ref_id' in 'on clause'
[Method: GET, Route: PurchaseReport/data]
in SYSTEMPATH\Database\BaseConnection.php on line 688.
 1 APPPATH\Models\PurchaseReportModel.php(314): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id`       = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
            WHERE
                1 = 1
                 AND base.enq_type_id = ? 
                AND base.tour_date >= ?
                AND base.tour_date < ?
        ', [...])
 2 APPPATH\Controllers\PurchaseReport.php(129): App\Models\PurchaseReportModel->getByDateRange('2025-06-16 00:00:00', '2025-06-17 00:00:00', 1, 3)
 3 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->data()
 4 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 5 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 6 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 7 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
 8 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 09:47:02 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'e.tour_plan_ref_id' in 'on clause'
in SYSTEMPATH\Database\MySQLi\Connection.php on line 317.
 1 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id`       = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
            WHERE
                1 = 1
                 AND base.enq_type_id = 3 
                AND base.tour_date >= \'2025-06-16 00:00:00\'
                AND base.tour_date < \'2025-06-17 00:00:00\'
        ')
 2 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id`       = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
            WHERE
                1 = 1
                 AND base.enq_type_id = 3 
                AND base.tour_date >= \'2025-06-16 00:00:00\'
                AND base.tour_date < \'2025-06-17 00:00:00\'
        ')
 3 APPPATH\Models\PurchaseReportModel.php(314): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id`       = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
            WHERE
                1 = 1
                 AND base.enq_type_id = ? 
                AND base.tour_date >= ?
                AND base.tour_date < ?
        ', [...])
 4 APPPATH\Controllers\PurchaseReport.php(129): App\Models\PurchaseReportModel->getByDateRange('2025-06-16 00:00:00', '2025-06-17 00:00:00', 1, 3)
 5 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->data()
 6 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 7 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 8 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 9 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
10 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 09:47:02 --> [Caused by] mysqli_sql_exception: Unknown column 'e.tour_plan_ref_id' in 'on clause'
in SYSTEMPATH\Database\MySQLi\Connection.php on line 312.
 1 SYSTEMPATH\Database\MySQLi\Connection.php(312): mysqli->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id`       = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
            WHERE
                1 = 1
                 AND base.enq_type_id = 3 
                AND base.tour_date >= \'2025-06-16 00:00:00\'
                AND base.tour_date < \'2025-06-17 00:00:00\'
        ', 0)
 2 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id`       = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
            WHERE
                1 = 1
                 AND base.enq_type_id = 3 
                AND base.tour_date >= \'2025-06-16 00:00:00\'
                AND base.tour_date < \'2025-06-17 00:00:00\'
        ')
 3 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id`       = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
            WHERE
                1 = 1
                 AND base.enq_type_id = 3 
                AND base.tour_date >= \'2025-06-16 00:00:00\'
                AND base.tour_date < \'2025-06-17 00:00:00\'
        ')
 4 APPPATH\Models\PurchaseReportModel.php(314): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id`       = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
            WHERE
                1 = 1
                 AND base.enq_type_id = ? 
                AND base.tour_date >= ?
                AND base.tour_date < ?
        ', [...])
 5 APPPATH\Controllers\PurchaseReport.php(129): App\Models\PurchaseReportModel->getByDateRange('2025-06-16 00:00:00', '2025-06-17 00:00:00', 1, 3)
 6 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->data()
 7 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 8 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2025-06-16 10:04:52 --> mysqli_sql_exception: Unknown column 'double_room' in 'field list' in C:\wamp64\www\khm\system\Database\MySQLi\Connection.php:312
Stack trace:
#0 C:\wamp64\www\khm\system\Database\MySQLi\Connection.php(312): mysqli->query('\r\n            S...', 0)
#1 C:\wamp64\www\khm\system\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('\r\n            S...')
#2 C:\wamp64\www\khm\system\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('\r\n            S...')
#3 C:\wamp64\www\khm\app\Models\PurchaseReportModel.php(229): CodeIgniter\Database\BaseConnection->query('\r\n            S...')
#4 C:\wamp64\www\khm\app\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
#5 C:\wamp64\www\khm\system\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
#6 C:\wamp64\www\khm\system\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
#7 C:\wamp64\www\khm\system\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#8 C:\wamp64\www\khm\system\Boot.php(334): CodeIgniter\CodeIgniter->run()
#9 C:\wamp64\www\khm\system\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#10 C:\wamp64\www\khm\public\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#11 {main}
CRITICAL - 2025-06-16 10:04:52 --> CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'double_room' in 'field list'
[Method: GET, Route: PurchaseReport]
in SYSTEMPATH\Database\BaseConnection.php on line 688.
 1 APPPATH\Models\PurchaseReportModel.php(229): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name` AS `object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, `icd_agg`.`total_value`, `icd_agg`.`extra_cost`
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN (
        SELECT
            itinerary_details_id,
            COALESCE(
                SUM(CASE
                    WHEN cost_component_id = 6 AND room_type_id = 2 THEN tariff * COALESCE(double_room, 0)
                    WHEN cost_component_id = 6 AND room_type_id = 1 THEN tariff * COALESCE(single_room, 0)
                    WHEN cost_component_id = 9 AND room_type_id = 2 THEN tariff * COALESCE(extra_bed, 0)
                    WHEN cost_component_id = 12 AND room_type_id = 2 THEN tariff * COALESCE(child_with_bed, 0)
                    WHEN cost_component_id = 15 AND room_type_id = 2 THEN tariff * COALESCE(child_without_bed, 0)
                    ELSE 0
                END), 0
            ) AS total_value,
            COALESCE(
                SUM(CASE WHEN cost_component_id = 19 AND room_type_id = 1 THEN tariff ELSE 0 END),
                0
            ) AS extra_cost
        FROM khm_obj_itinerary_costing_details
        WHERE is_active = 1
        GROUP BY itinerary_details_id
    ) AS icd_agg ON `icd_agg`.`itinerary_details_id` = `koei`.`itinerary_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id` = `attr`.`entity_attr_value`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 2 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 3 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 4 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 5 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 6 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 7 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
 8 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 10:04:52 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'double_room' in 'field list'
in SYSTEMPATH\Database\MySQLi\Connection.php on line 317.
 1 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name` AS `object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, `icd_agg`.`total_value`, `icd_agg`.`extra_cost`
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN (
        SELECT
            itinerary_details_id,
            COALESCE(
                SUM(CASE
                    WHEN cost_component_id = 6 AND room_type_id = 2 THEN tariff * COALESCE(double_room, 0)
                    WHEN cost_component_id = 6 AND room_type_id = 1 THEN tariff * COALESCE(single_room, 0)
                    WHEN cost_component_id = 9 AND room_type_id = 2 THEN tariff * COALESCE(extra_bed, 0)
                    WHEN cost_component_id = 12 AND room_type_id = 2 THEN tariff * COALESCE(child_with_bed, 0)
                    WHEN cost_component_id = 15 AND room_type_id = 2 THEN tariff * COALESCE(child_without_bed, 0)
                    ELSE 0
                END), 0
            ) AS total_value,
            COALESCE(
                SUM(CASE WHEN cost_component_id = 19 AND room_type_id = 1 THEN tariff ELSE 0 END),
                0
            ) AS extra_cost
        FROM khm_obj_itinerary_costing_details
        WHERE is_active = 1
        GROUP BY itinerary_details_id
    ) AS icd_agg ON `icd_agg`.`itinerary_details_id` = `koei`.`itinerary_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id` = `attr`.`entity_attr_value`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 2 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name` AS `object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, `icd_agg`.`total_value`, `icd_agg`.`extra_cost`
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN (
        SELECT
            itinerary_details_id,
            COALESCE(
                SUM(CASE
                    WHEN cost_component_id = 6 AND room_type_id = 2 THEN tariff * COALESCE(double_room, 0)
                    WHEN cost_component_id = 6 AND room_type_id = 1 THEN tariff * COALESCE(single_room, 0)
                    WHEN cost_component_id = 9 AND room_type_id = 2 THEN tariff * COALESCE(extra_bed, 0)
                    WHEN cost_component_id = 12 AND room_type_id = 2 THEN tariff * COALESCE(child_with_bed, 0)
                    WHEN cost_component_id = 15 AND room_type_id = 2 THEN tariff * COALESCE(child_without_bed, 0)
                    ELSE 0
                END), 0
            ) AS total_value,
            COALESCE(
                SUM(CASE WHEN cost_component_id = 19 AND room_type_id = 1 THEN tariff ELSE 0 END),
                0
            ) AS extra_cost
        FROM khm_obj_itinerary_costing_details
        WHERE is_active = 1
        GROUP BY itinerary_details_id
    ) AS icd_agg ON `icd_agg`.`itinerary_details_id` = `koei`.`itinerary_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id` = `attr`.`entity_attr_value`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 3 APPPATH\Models\PurchaseReportModel.php(229): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name` AS `object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, `icd_agg`.`total_value`, `icd_agg`.`extra_cost`
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN (
        SELECT
            itinerary_details_id,
            COALESCE(
                SUM(CASE
                    WHEN cost_component_id = 6 AND room_type_id = 2 THEN tariff * COALESCE(double_room, 0)
                    WHEN cost_component_id = 6 AND room_type_id = 1 THEN tariff * COALESCE(single_room, 0)
                    WHEN cost_component_id = 9 AND room_type_id = 2 THEN tariff * COALESCE(extra_bed, 0)
                    WHEN cost_component_id = 12 AND room_type_id = 2 THEN tariff * COALESCE(child_with_bed, 0)
                    WHEN cost_component_id = 15 AND room_type_id = 2 THEN tariff * COALESCE(child_without_bed, 0)
                    ELSE 0
                END), 0
            ) AS total_value,
            COALESCE(
                SUM(CASE WHEN cost_component_id = 19 AND room_type_id = 1 THEN tariff ELSE 0 END),
                0
            ) AS extra_cost
        FROM khm_obj_itinerary_costing_details
        WHERE is_active = 1
        GROUP BY itinerary_details_id
    ) AS icd_agg ON `icd_agg`.`itinerary_details_id` = `koei`.`itinerary_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id` = `attr`.`entity_attr_value`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 4 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 5 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 6 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 7 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 8 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 9 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
10 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 10:04:52 --> [Caused by] mysqli_sql_exception: Unknown column 'double_room' in 'field list'
in SYSTEMPATH\Database\MySQLi\Connection.php on line 312.
 1 SYSTEMPATH\Database\MySQLi\Connection.php(312): mysqli->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name` AS `object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, `icd_agg`.`total_value`, `icd_agg`.`extra_cost`
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN (
        SELECT
            itinerary_details_id,
            COALESCE(
                SUM(CASE
                    WHEN cost_component_id = 6 AND room_type_id = 2 THEN tariff * COALESCE(double_room, 0)
                    WHEN cost_component_id = 6 AND room_type_id = 1 THEN tariff * COALESCE(single_room, 0)
                    WHEN cost_component_id = 9 AND room_type_id = 2 THEN tariff * COALESCE(extra_bed, 0)
                    WHEN cost_component_id = 12 AND room_type_id = 2 THEN tariff * COALESCE(child_with_bed, 0)
                    WHEN cost_component_id = 15 AND room_type_id = 2 THEN tariff * COALESCE(child_without_bed, 0)
                    ELSE 0
                END), 0
            ) AS total_value,
            COALESCE(
                SUM(CASE WHEN cost_component_id = 19 AND room_type_id = 1 THEN tariff ELSE 0 END),
                0
            ) AS extra_cost
        FROM khm_obj_itinerary_costing_details
        WHERE is_active = 1
        GROUP BY itinerary_details_id
    ) AS icd_agg ON `icd_agg`.`itinerary_details_id` = `koei`.`itinerary_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id` = `attr`.`entity_attr_value`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ', 0)
 2 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name` AS `object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, `icd_agg`.`total_value`, `icd_agg`.`extra_cost`
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN (
        SELECT
            itinerary_details_id,
            COALESCE(
                SUM(CASE
                    WHEN cost_component_id = 6 AND room_type_id = 2 THEN tariff * COALESCE(double_room, 0)
                    WHEN cost_component_id = 6 AND room_type_id = 1 THEN tariff * COALESCE(single_room, 0)
                    WHEN cost_component_id = 9 AND room_type_id = 2 THEN tariff * COALESCE(extra_bed, 0)
                    WHEN cost_component_id = 12 AND room_type_id = 2 THEN tariff * COALESCE(child_with_bed, 0)
                    WHEN cost_component_id = 15 AND room_type_id = 2 THEN tariff * COALESCE(child_without_bed, 0)
                    ELSE 0
                END), 0
            ) AS total_value,
            COALESCE(
                SUM(CASE WHEN cost_component_id = 19 AND room_type_id = 1 THEN tariff ELSE 0 END),
                0
            ) AS extra_cost
        FROM khm_obj_itinerary_costing_details
        WHERE is_active = 1
        GROUP BY itinerary_details_id
    ) AS icd_agg ON `icd_agg`.`itinerary_details_id` = `koei`.`itinerary_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id` = `attr`.`entity_attr_value`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 3 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name` AS `object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, `icd_agg`.`total_value`, `icd_agg`.`extra_cost`
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN (
        SELECT
            itinerary_details_id,
            COALESCE(
                SUM(CASE
                    WHEN cost_component_id = 6 AND room_type_id = 2 THEN tariff * COALESCE(double_room, 0)
                    WHEN cost_component_id = 6 AND room_type_id = 1 THEN tariff * COALESCE(single_room, 0)
                    WHEN cost_component_id = 9 AND room_type_id = 2 THEN tariff * COALESCE(extra_bed, 0)
                    WHEN cost_component_id = 12 AND room_type_id = 2 THEN tariff * COALESCE(child_with_bed, 0)
                    WHEN cost_component_id = 15 AND room_type_id = 2 THEN tariff * COALESCE(child_without_bed, 0)
                    ELSE 0
                END), 0
            ) AS total_value,
            COALESCE(
                SUM(CASE WHEN cost_component_id = 19 AND room_type_id = 1 THEN tariff ELSE 0 END),
                0
            ) AS extra_cost
        FROM khm_obj_itinerary_costing_details
        WHERE is_active = 1
        GROUP BY itinerary_details_id
    ) AS icd_agg ON `icd_agg`.`itinerary_details_id` = `koei`.`itinerary_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id` = `attr`.`entity_attr_value`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 4 APPPATH\Models\PurchaseReportModel.php(229): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name` AS `object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, `icd_agg`.`total_value`, `icd_agg`.`extra_cost`
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN (
        SELECT
            itinerary_details_id,
            COALESCE(
                SUM(CASE
                    WHEN cost_component_id = 6 AND room_type_id = 2 THEN tariff * COALESCE(double_room, 0)
                    WHEN cost_component_id = 6 AND room_type_id = 1 THEN tariff * COALESCE(single_room, 0)
                    WHEN cost_component_id = 9 AND room_type_id = 2 THEN tariff * COALESCE(extra_bed, 0)
                    WHEN cost_component_id = 12 AND room_type_id = 2 THEN tariff * COALESCE(child_with_bed, 0)
                    WHEN cost_component_id = 15 AND room_type_id = 2 THEN tariff * COALESCE(child_without_bed, 0)
                    ELSE 0
                END), 0
            ) AS total_value,
            COALESCE(
                SUM(CASE WHEN cost_component_id = 19 AND room_type_id = 1 THEN tariff ELSE 0 END),
                0
            ) AS extra_cost
        FROM khm_obj_itinerary_costing_details
        WHERE is_active = 1
        GROUP BY itinerary_details_id
    ) AS icd_agg ON `icd_agg`.`itinerary_details_id` = `koei`.`itinerary_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id` = `attr`.`entity_attr_value`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 5 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 6 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 7 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 8 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2025-06-16 10:06:13 --> mysqli_sql_exception: Unknown column 'double_room' in 'field list' in C:\wamp64\www\khm\system\Database\MySQLi\Connection.php:312
Stack trace:
#0 C:\wamp64\www\khm\system\Database\MySQLi\Connection.php(312): mysqli->query('\r\n            S...', 0)
#1 C:\wamp64\www\khm\system\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('\r\n            S...')
#2 C:\wamp64\www\khm\system\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('\r\n            S...')
#3 C:\wamp64\www\khm\app\Models\PurchaseReportModel.php(229): CodeIgniter\Database\BaseConnection->query('\r\n            S...')
#4 C:\wamp64\www\khm\app\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
#5 C:\wamp64\www\khm\system\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
#6 C:\wamp64\www\khm\system\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
#7 C:\wamp64\www\khm\system\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#8 C:\wamp64\www\khm\system\Boot.php(334): CodeIgniter\CodeIgniter->run()
#9 C:\wamp64\www\khm\system\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#10 C:\wamp64\www\khm\public\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#11 {main}
CRITICAL - 2025-06-16 10:06:13 --> CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'double_room' in 'field list'
[Method: GET, Route: PurchaseReport]
in SYSTEMPATH\Database\BaseConnection.php on line 688.
 1 APPPATH\Models\PurchaseReportModel.php(229): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name` AS `object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, `icd_agg`.`total_value`, `icd_agg`.`extra_cost`
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN (
        SELECT
            itinerary_details_id,
            COALESCE(
                SUM(CASE
                    WHEN cost_component_id = 6 AND room_type_id = 2 THEN tariff * COALESCE(double_room, 0)
                    WHEN cost_component_id = 6 AND room_type_id = 1 THEN tariff * COALESCE(single_room, 0)
                    WHEN cost_component_id = 9 AND room_type_id = 2 THEN tariff * COALESCE(extra_bed, 0)
                    WHEN cost_component_id = 12 AND room_type_id = 2 THEN tariff * COALESCE(child_with_bed, 0)
                    WHEN cost_component_id = 15 AND room_type_id = 2 THEN tariff * COALESCE(child_without_bed, 0)
                    ELSE 0
                END), 0
            ) AS total_value,
            COALESCE(
                SUM(CASE WHEN cost_component_id = 19 AND room_type_id = 1 THEN tariff ELSE 0 END),
                0
            ) AS extra_cost
        FROM khm_obj_itinerary_costing_details
        WHERE is_active = 1
        GROUP BY itinerary_details_id
    ) AS icd_agg ON `icd_agg`.`itinerary_details_id` = `koei`.`itinerary_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id` = `attr`.`entity_attr_value`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 2 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 3 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 4 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 5 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 6 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 7 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
 8 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 10:06:13 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'double_room' in 'field list'
in SYSTEMPATH\Database\MySQLi\Connection.php on line 317.
 1 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name` AS `object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, `icd_agg`.`total_value`, `icd_agg`.`extra_cost`
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN (
        SELECT
            itinerary_details_id,
            COALESCE(
                SUM(CASE
                    WHEN cost_component_id = 6 AND room_type_id = 2 THEN tariff * COALESCE(double_room, 0)
                    WHEN cost_component_id = 6 AND room_type_id = 1 THEN tariff * COALESCE(single_room, 0)
                    WHEN cost_component_id = 9 AND room_type_id = 2 THEN tariff * COALESCE(extra_bed, 0)
                    WHEN cost_component_id = 12 AND room_type_id = 2 THEN tariff * COALESCE(child_with_bed, 0)
                    WHEN cost_component_id = 15 AND room_type_id = 2 THEN tariff * COALESCE(child_without_bed, 0)
                    ELSE 0
                END), 0
            ) AS total_value,
            COALESCE(
                SUM(CASE WHEN cost_component_id = 19 AND room_type_id = 1 THEN tariff ELSE 0 END),
                0
            ) AS extra_cost
        FROM khm_obj_itinerary_costing_details
        WHERE is_active = 1
        GROUP BY itinerary_details_id
    ) AS icd_agg ON `icd_agg`.`itinerary_details_id` = `koei`.`itinerary_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id` = `attr`.`entity_attr_value`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 2 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name` AS `object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, `icd_agg`.`total_value`, `icd_agg`.`extra_cost`
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN (
        SELECT
            itinerary_details_id,
            COALESCE(
                SUM(CASE
                    WHEN cost_component_id = 6 AND room_type_id = 2 THEN tariff * COALESCE(double_room, 0)
                    WHEN cost_component_id = 6 AND room_type_id = 1 THEN tariff * COALESCE(single_room, 0)
                    WHEN cost_component_id = 9 AND room_type_id = 2 THEN tariff * COALESCE(extra_bed, 0)
                    WHEN cost_component_id = 12 AND room_type_id = 2 THEN tariff * COALESCE(child_with_bed, 0)
                    WHEN cost_component_id = 15 AND room_type_id = 2 THEN tariff * COALESCE(child_without_bed, 0)
                    ELSE 0
                END), 0
            ) AS total_value,
            COALESCE(
                SUM(CASE WHEN cost_component_id = 19 AND room_type_id = 1 THEN tariff ELSE 0 END),
                0
            ) AS extra_cost
        FROM khm_obj_itinerary_costing_details
        WHERE is_active = 1
        GROUP BY itinerary_details_id
    ) AS icd_agg ON `icd_agg`.`itinerary_details_id` = `koei`.`itinerary_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id` = `attr`.`entity_attr_value`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 3 APPPATH\Models\PurchaseReportModel.php(229): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name` AS `object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, `icd_agg`.`total_value`, `icd_agg`.`extra_cost`
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN (
        SELECT
            itinerary_details_id,
            COALESCE(
                SUM(CASE
                    WHEN cost_component_id = 6 AND room_type_id = 2 THEN tariff * COALESCE(double_room, 0)
                    WHEN cost_component_id = 6 AND room_type_id = 1 THEN tariff * COALESCE(single_room, 0)
                    WHEN cost_component_id = 9 AND room_type_id = 2 THEN tariff * COALESCE(extra_bed, 0)
                    WHEN cost_component_id = 12 AND room_type_id = 2 THEN tariff * COALESCE(child_with_bed, 0)
                    WHEN cost_component_id = 15 AND room_type_id = 2 THEN tariff * COALESCE(child_without_bed, 0)
                    ELSE 0
                END), 0
            ) AS total_value,
            COALESCE(
                SUM(CASE WHEN cost_component_id = 19 AND room_type_id = 1 THEN tariff ELSE 0 END),
                0
            ) AS extra_cost
        FROM khm_obj_itinerary_costing_details
        WHERE is_active = 1
        GROUP BY itinerary_details_id
    ) AS icd_agg ON `icd_agg`.`itinerary_details_id` = `koei`.`itinerary_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id` = `attr`.`entity_attr_value`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 4 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 5 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 6 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 7 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 8 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 9 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
10 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 10:06:13 --> [Caused by] mysqli_sql_exception: Unknown column 'double_room' in 'field list'
in SYSTEMPATH\Database\MySQLi\Connection.php on line 312.
 1 SYSTEMPATH\Database\MySQLi\Connection.php(312): mysqli->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name` AS `object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, `icd_agg`.`total_value`, `icd_agg`.`extra_cost`
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN (
        SELECT
            itinerary_details_id,
            COALESCE(
                SUM(CASE
                    WHEN cost_component_id = 6 AND room_type_id = 2 THEN tariff * COALESCE(double_room, 0)
                    WHEN cost_component_id = 6 AND room_type_id = 1 THEN tariff * COALESCE(single_room, 0)
                    WHEN cost_component_id = 9 AND room_type_id = 2 THEN tariff * COALESCE(extra_bed, 0)
                    WHEN cost_component_id = 12 AND room_type_id = 2 THEN tariff * COALESCE(child_with_bed, 0)
                    WHEN cost_component_id = 15 AND room_type_id = 2 THEN tariff * COALESCE(child_without_bed, 0)
                    ELSE 0
                END), 0
            ) AS total_value,
            COALESCE(
                SUM(CASE WHEN cost_component_id = 19 AND room_type_id = 1 THEN tariff ELSE 0 END),
                0
            ) AS extra_cost
        FROM khm_obj_itinerary_costing_details
        WHERE is_active = 1
        GROUP BY itinerary_details_id
    ) AS icd_agg ON `icd_agg`.`itinerary_details_id` = `koei`.`itinerary_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id` = `attr`.`entity_attr_value`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ', 0)
 2 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name` AS `object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, `icd_agg`.`total_value`, `icd_agg`.`extra_cost`
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN (
        SELECT
            itinerary_details_id,
            COALESCE(
                SUM(CASE
                    WHEN cost_component_id = 6 AND room_type_id = 2 THEN tariff * COALESCE(double_room, 0)
                    WHEN cost_component_id = 6 AND room_type_id = 1 THEN tariff * COALESCE(single_room, 0)
                    WHEN cost_component_id = 9 AND room_type_id = 2 THEN tariff * COALESCE(extra_bed, 0)
                    WHEN cost_component_id = 12 AND room_type_id = 2 THEN tariff * COALESCE(child_with_bed, 0)
                    WHEN cost_component_id = 15 AND room_type_id = 2 THEN tariff * COALESCE(child_without_bed, 0)
                    ELSE 0
                END), 0
            ) AS total_value,
            COALESCE(
                SUM(CASE WHEN cost_component_id = 19 AND room_type_id = 1 THEN tariff ELSE 0 END),
                0
            ) AS extra_cost
        FROM khm_obj_itinerary_costing_details
        WHERE is_active = 1
        GROUP BY itinerary_details_id
    ) AS icd_agg ON `icd_agg`.`itinerary_details_id` = `koei`.`itinerary_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id` = `attr`.`entity_attr_value`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 3 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name` AS `object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, `icd_agg`.`total_value`, `icd_agg`.`extra_cost`
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN (
        SELECT
            itinerary_details_id,
            COALESCE(
                SUM(CASE
                    WHEN cost_component_id = 6 AND room_type_id = 2 THEN tariff * COALESCE(double_room, 0)
                    WHEN cost_component_id = 6 AND room_type_id = 1 THEN tariff * COALESCE(single_room, 0)
                    WHEN cost_component_id = 9 AND room_type_id = 2 THEN tariff * COALESCE(extra_bed, 0)
                    WHEN cost_component_id = 12 AND room_type_id = 2 THEN tariff * COALESCE(child_with_bed, 0)
                    WHEN cost_component_id = 15 AND room_type_id = 2 THEN tariff * COALESCE(child_without_bed, 0)
                    ELSE 0
                END), 0
            ) AS total_value,
            COALESCE(
                SUM(CASE WHEN cost_component_id = 19 AND room_type_id = 1 THEN tariff ELSE 0 END),
                0
            ) AS extra_cost
        FROM khm_obj_itinerary_costing_details
        WHERE is_active = 1
        GROUP BY itinerary_details_id
    ) AS icd_agg ON `icd_agg`.`itinerary_details_id` = `koei`.`itinerary_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id` = `attr`.`entity_attr_value`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 4 APPPATH\Models\PurchaseReportModel.php(229): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name` AS `object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, `icd_agg`.`total_value`, `icd_agg`.`extra_cost`
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN (
        SELECT
            itinerary_details_id,
            COALESCE(
                SUM(CASE
                    WHEN cost_component_id = 6 AND room_type_id = 2 THEN tariff * COALESCE(double_room, 0)
                    WHEN cost_component_id = 6 AND room_type_id = 1 THEN tariff * COALESCE(single_room, 0)
                    WHEN cost_component_id = 9 AND room_type_id = 2 THEN tariff * COALESCE(extra_bed, 0)
                    WHEN cost_component_id = 12 AND room_type_id = 2 THEN tariff * COALESCE(child_with_bed, 0)
                    WHEN cost_component_id = 15 AND room_type_id = 2 THEN tariff * COALESCE(child_without_bed, 0)
                    ELSE 0
                END), 0
            ) AS total_value,
            COALESCE(
                SUM(CASE WHEN cost_component_id = 19 AND room_type_id = 1 THEN tariff ELSE 0 END),
                0
            ) AS extra_cost
        FROM khm_obj_itinerary_costing_details
        WHERE is_active = 1
        GROUP BY itinerary_details_id
    ) AS icd_agg ON `icd_agg`.`itinerary_details_id` = `koei`.`itinerary_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id` = `attr`.`entity_attr_value`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 5 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 6 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 7 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 8 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2025-06-16 10:06:15 --> mysqli_sql_exception: Unknown column 'double_room' in 'field list' in C:\wamp64\www\khm\system\Database\MySQLi\Connection.php:312
Stack trace:
#0 C:\wamp64\www\khm\system\Database\MySQLi\Connection.php(312): mysqli->query('\r\n            S...', 0)
#1 C:\wamp64\www\khm\system\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('\r\n            S...')
#2 C:\wamp64\www\khm\system\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('\r\n            S...')
#3 C:\wamp64\www\khm\app\Models\PurchaseReportModel.php(229): CodeIgniter\Database\BaseConnection->query('\r\n            S...')
#4 C:\wamp64\www\khm\app\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
#5 C:\wamp64\www\khm\system\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
#6 C:\wamp64\www\khm\system\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
#7 C:\wamp64\www\khm\system\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#8 C:\wamp64\www\khm\system\Boot.php(334): CodeIgniter\CodeIgniter->run()
#9 C:\wamp64\www\khm\system\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#10 C:\wamp64\www\khm\public\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#11 {main}
CRITICAL - 2025-06-16 10:06:15 --> CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'double_room' in 'field list'
[Method: GET, Route: PurchaseReport]
in SYSTEMPATH\Database\BaseConnection.php on line 688.
 1 APPPATH\Models\PurchaseReportModel.php(229): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name` AS `object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, `icd_agg`.`total_value`, `icd_agg`.`extra_cost`
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN (
        SELECT
            itinerary_details_id,
            COALESCE(
                SUM(CASE
                    WHEN cost_component_id = 6 AND room_type_id = 2 THEN tariff * COALESCE(double_room, 0)
                    WHEN cost_component_id = 6 AND room_type_id = 1 THEN tariff * COALESCE(single_room, 0)
                    WHEN cost_component_id = 9 AND room_type_id = 2 THEN tariff * COALESCE(extra_bed, 0)
                    WHEN cost_component_id = 12 AND room_type_id = 2 THEN tariff * COALESCE(child_with_bed, 0)
                    WHEN cost_component_id = 15 AND room_type_id = 2 THEN tariff * COALESCE(child_without_bed, 0)
                    ELSE 0
                END), 0
            ) AS total_value,
            COALESCE(
                SUM(CASE WHEN cost_component_id = 19 AND room_type_id = 1 THEN tariff ELSE 0 END),
                0
            ) AS extra_cost
        FROM khm_obj_itinerary_costing_details
        WHERE is_active = 1
        GROUP BY itinerary_details_id
    ) AS icd_agg ON `icd_agg`.`itinerary_details_id` = `koei`.`itinerary_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id` = `attr`.`entity_attr_value`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 2 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 3 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 4 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 5 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 6 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 7 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
 8 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 10:06:15 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'double_room' in 'field list'
in SYSTEMPATH\Database\MySQLi\Connection.php on line 317.
 1 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name` AS `object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, `icd_agg`.`total_value`, `icd_agg`.`extra_cost`
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN (
        SELECT
            itinerary_details_id,
            COALESCE(
                SUM(CASE
                    WHEN cost_component_id = 6 AND room_type_id = 2 THEN tariff * COALESCE(double_room, 0)
                    WHEN cost_component_id = 6 AND room_type_id = 1 THEN tariff * COALESCE(single_room, 0)
                    WHEN cost_component_id = 9 AND room_type_id = 2 THEN tariff * COALESCE(extra_bed, 0)
                    WHEN cost_component_id = 12 AND room_type_id = 2 THEN tariff * COALESCE(child_with_bed, 0)
                    WHEN cost_component_id = 15 AND room_type_id = 2 THEN tariff * COALESCE(child_without_bed, 0)
                    ELSE 0
                END), 0
            ) AS total_value,
            COALESCE(
                SUM(CASE WHEN cost_component_id = 19 AND room_type_id = 1 THEN tariff ELSE 0 END),
                0
            ) AS extra_cost
        FROM khm_obj_itinerary_costing_details
        WHERE is_active = 1
        GROUP BY itinerary_details_id
    ) AS icd_agg ON `icd_agg`.`itinerary_details_id` = `koei`.`itinerary_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id` = `attr`.`entity_attr_value`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 2 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name` AS `object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, `icd_agg`.`total_value`, `icd_agg`.`extra_cost`
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN (
        SELECT
            itinerary_details_id,
            COALESCE(
                SUM(CASE
                    WHEN cost_component_id = 6 AND room_type_id = 2 THEN tariff * COALESCE(double_room, 0)
                    WHEN cost_component_id = 6 AND room_type_id = 1 THEN tariff * COALESCE(single_room, 0)
                    WHEN cost_component_id = 9 AND room_type_id = 2 THEN tariff * COALESCE(extra_bed, 0)
                    WHEN cost_component_id = 12 AND room_type_id = 2 THEN tariff * COALESCE(child_with_bed, 0)
                    WHEN cost_component_id = 15 AND room_type_id = 2 THEN tariff * COALESCE(child_without_bed, 0)
                    ELSE 0
                END), 0
            ) AS total_value,
            COALESCE(
                SUM(CASE WHEN cost_component_id = 19 AND room_type_id = 1 THEN tariff ELSE 0 END),
                0
            ) AS extra_cost
        FROM khm_obj_itinerary_costing_details
        WHERE is_active = 1
        GROUP BY itinerary_details_id
    ) AS icd_agg ON `icd_agg`.`itinerary_details_id` = `koei`.`itinerary_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id` = `attr`.`entity_attr_value`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 3 APPPATH\Models\PurchaseReportModel.php(229): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name` AS `object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, `icd_agg`.`total_value`, `icd_agg`.`extra_cost`
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN (
        SELECT
            itinerary_details_id,
            COALESCE(
                SUM(CASE
                    WHEN cost_component_id = 6 AND room_type_id = 2 THEN tariff * COALESCE(double_room, 0)
                    WHEN cost_component_id = 6 AND room_type_id = 1 THEN tariff * COALESCE(single_room, 0)
                    WHEN cost_component_id = 9 AND room_type_id = 2 THEN tariff * COALESCE(extra_bed, 0)
                    WHEN cost_component_id = 12 AND room_type_id = 2 THEN tariff * COALESCE(child_with_bed, 0)
                    WHEN cost_component_id = 15 AND room_type_id = 2 THEN tariff * COALESCE(child_without_bed, 0)
                    ELSE 0
                END), 0
            ) AS total_value,
            COALESCE(
                SUM(CASE WHEN cost_component_id = 19 AND room_type_id = 1 THEN tariff ELSE 0 END),
                0
            ) AS extra_cost
        FROM khm_obj_itinerary_costing_details
        WHERE is_active = 1
        GROUP BY itinerary_details_id
    ) AS icd_agg ON `icd_agg`.`itinerary_details_id` = `koei`.`itinerary_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id` = `attr`.`entity_attr_value`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 4 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 5 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 6 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 7 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 8 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 9 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
10 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 10:06:15 --> [Caused by] mysqli_sql_exception: Unknown column 'double_room' in 'field list'
in SYSTEMPATH\Database\MySQLi\Connection.php on line 312.
 1 SYSTEMPATH\Database\MySQLi\Connection.php(312): mysqli->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name` AS `object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, `icd_agg`.`total_value`, `icd_agg`.`extra_cost`
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN (
        SELECT
            itinerary_details_id,
            COALESCE(
                SUM(CASE
                    WHEN cost_component_id = 6 AND room_type_id = 2 THEN tariff * COALESCE(double_room, 0)
                    WHEN cost_component_id = 6 AND room_type_id = 1 THEN tariff * COALESCE(single_room, 0)
                    WHEN cost_component_id = 9 AND room_type_id = 2 THEN tariff * COALESCE(extra_bed, 0)
                    WHEN cost_component_id = 12 AND room_type_id = 2 THEN tariff * COALESCE(child_with_bed, 0)
                    WHEN cost_component_id = 15 AND room_type_id = 2 THEN tariff * COALESCE(child_without_bed, 0)
                    ELSE 0
                END), 0
            ) AS total_value,
            COALESCE(
                SUM(CASE WHEN cost_component_id = 19 AND room_type_id = 1 THEN tariff ELSE 0 END),
                0
            ) AS extra_cost
        FROM khm_obj_itinerary_costing_details
        WHERE is_active = 1
        GROUP BY itinerary_details_id
    ) AS icd_agg ON `icd_agg`.`itinerary_details_id` = `koei`.`itinerary_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id` = `attr`.`entity_attr_value`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ', 0)
 2 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name` AS `object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, `icd_agg`.`total_value`, `icd_agg`.`extra_cost`
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN (
        SELECT
            itinerary_details_id,
            COALESCE(
                SUM(CASE
                    WHEN cost_component_id = 6 AND room_type_id = 2 THEN tariff * COALESCE(double_room, 0)
                    WHEN cost_component_id = 6 AND room_type_id = 1 THEN tariff * COALESCE(single_room, 0)
                    WHEN cost_component_id = 9 AND room_type_id = 2 THEN tariff * COALESCE(extra_bed, 0)
                    WHEN cost_component_id = 12 AND room_type_id = 2 THEN tariff * COALESCE(child_with_bed, 0)
                    WHEN cost_component_id = 15 AND room_type_id = 2 THEN tariff * COALESCE(child_without_bed, 0)
                    ELSE 0
                END), 0
            ) AS total_value,
            COALESCE(
                SUM(CASE WHEN cost_component_id = 19 AND room_type_id = 1 THEN tariff ELSE 0 END),
                0
            ) AS extra_cost
        FROM khm_obj_itinerary_costing_details
        WHERE is_active = 1
        GROUP BY itinerary_details_id
    ) AS icd_agg ON `icd_agg`.`itinerary_details_id` = `koei`.`itinerary_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id` = `attr`.`entity_attr_value`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 3 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name` AS `object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, `icd_agg`.`total_value`, `icd_agg`.`extra_cost`
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN (
        SELECT
            itinerary_details_id,
            COALESCE(
                SUM(CASE
                    WHEN cost_component_id = 6 AND room_type_id = 2 THEN tariff * COALESCE(double_room, 0)
                    WHEN cost_component_id = 6 AND room_type_id = 1 THEN tariff * COALESCE(single_room, 0)
                    WHEN cost_component_id = 9 AND room_type_id = 2 THEN tariff * COALESCE(extra_bed, 0)
                    WHEN cost_component_id = 12 AND room_type_id = 2 THEN tariff * COALESCE(child_with_bed, 0)
                    WHEN cost_component_id = 15 AND room_type_id = 2 THEN tariff * COALESCE(child_without_bed, 0)
                    ELSE 0
                END), 0
            ) AS total_value,
            COALESCE(
                SUM(CASE WHEN cost_component_id = 19 AND room_type_id = 1 THEN tariff ELSE 0 END),
                0
            ) AS extra_cost
        FROM khm_obj_itinerary_costing_details
        WHERE is_active = 1
        GROUP BY itinerary_details_id
    ) AS icd_agg ON `icd_agg`.`itinerary_details_id` = `koei`.`itinerary_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id` = `attr`.`entity_attr_value`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 4 APPPATH\Models\PurchaseReportModel.php(229): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name` AS `object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, `icd_agg`.`total_value`, `icd_agg`.`extra_cost`
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN (
        SELECT
            itinerary_details_id,
            COALESCE(
                SUM(CASE
                    WHEN cost_component_id = 6 AND room_type_id = 2 THEN tariff * COALESCE(double_room, 0)
                    WHEN cost_component_id = 6 AND room_type_id = 1 THEN tariff * COALESCE(single_room, 0)
                    WHEN cost_component_id = 9 AND room_type_id = 2 THEN tariff * COALESCE(extra_bed, 0)
                    WHEN cost_component_id = 12 AND room_type_id = 2 THEN tariff * COALESCE(child_with_bed, 0)
                    WHEN cost_component_id = 15 AND room_type_id = 2 THEN tariff * COALESCE(child_without_bed, 0)
                    ELSE 0
                END), 0
            ) AS total_value,
            COALESCE(
                SUM(CASE WHEN cost_component_id = 19 AND room_type_id = 1 THEN tariff ELSE 0 END),
                0
            ) AS extra_cost
        FROM khm_obj_itinerary_costing_details
        WHERE is_active = 1
        GROUP BY itinerary_details_id
    ) AS icd_agg ON `icd_agg`.`itinerary_details_id` = `koei`.`itinerary_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id` = `attr`.`entity_attr_value`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 5 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 6 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 7 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 8 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2025-06-16 12:12:21 --> mysqli_sql_exception: Unknown column 'e.tour_plan_ref_id' in 'on clause' in C:\wamp64\www\khm\system\Database\MySQLi\Connection.php:312
Stack trace:
#0 C:\wamp64\www\khm\system\Database\MySQLi\Connection.php(312): mysqli->query('\r\n            S...', 0)
#1 C:\wamp64\www\khm\system\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('\r\n            S...')
#2 C:\wamp64\www\khm\system\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('\r\n            S...')
#3 C:\wamp64\www\khm\app\Models\PurchaseReportModel.php(269): CodeIgniter\Database\BaseConnection->query('\r\n            S...')
#4 C:\wamp64\www\khm\app\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
#5 C:\wamp64\www\khm\system\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
#6 C:\wamp64\www\khm\system\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
#7 C:\wamp64\www\khm\system\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#8 C:\wamp64\www\khm\system\Boot.php(334): CodeIgniter\CodeIgniter->run()
#9 C:\wamp64\www\khm\system\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#10 C:\wamp64\www\khm\public\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#11 {main}
CRITICAL - 2025-06-16 12:12:21 --> CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'e.tour_plan_ref_id' in 'on clause'
[Method: GET, Route: PurchaseReport]
in SYSTEMPATH\Database\BaseConnection.php on line 688.
 1 APPPATH\Models\PurchaseReportModel.php(269): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 2 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 3 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 4 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 5 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 6 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 7 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
 8 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 12:12:21 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'e.tour_plan_ref_id' in 'on clause'
in SYSTEMPATH\Database\MySQLi\Connection.php on line 317.
 1 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 2 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 3 APPPATH\Models\PurchaseReportModel.php(269): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 4 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 5 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 6 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 7 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 8 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 9 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
10 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 12:12:21 --> [Caused by] mysqli_sql_exception: Unknown column 'e.tour_plan_ref_id' in 'on clause'
in SYSTEMPATH\Database\MySQLi\Connection.php on line 312.
 1 SYSTEMPATH\Database\MySQLi\Connection.php(312): mysqli->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ', 0)
 2 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 3 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 4 APPPATH\Models\PurchaseReportModel.php(269): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 5 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 6 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 7 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 8 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2025-06-16 12:12:23 --> mysqli_sql_exception: Unknown column 'e.tour_plan_ref_id' in 'on clause' in C:\wamp64\www\khm\system\Database\MySQLi\Connection.php:312
Stack trace:
#0 C:\wamp64\www\khm\system\Database\MySQLi\Connection.php(312): mysqli->query('\r\n            S...', 0)
#1 C:\wamp64\www\khm\system\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('\r\n            S...')
#2 C:\wamp64\www\khm\system\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('\r\n            S...')
#3 C:\wamp64\www\khm\app\Models\PurchaseReportModel.php(269): CodeIgniter\Database\BaseConnection->query('\r\n            S...')
#4 C:\wamp64\www\khm\app\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
#5 C:\wamp64\www\khm\system\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
#6 C:\wamp64\www\khm\system\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
#7 C:\wamp64\www\khm\system\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#8 C:\wamp64\www\khm\system\Boot.php(334): CodeIgniter\CodeIgniter->run()
#9 C:\wamp64\www\khm\system\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#10 C:\wamp64\www\khm\public\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#11 {main}
CRITICAL - 2025-06-16 12:12:23 --> CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'e.tour_plan_ref_id' in 'on clause'
[Method: GET, Route: PurchaseReport]
in SYSTEMPATH\Database\BaseConnection.php on line 688.
 1 APPPATH\Models\PurchaseReportModel.php(269): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 2 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 3 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 4 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 5 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 6 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 7 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
 8 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 12:12:23 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'e.tour_plan_ref_id' in 'on clause'
in SYSTEMPATH\Database\MySQLi\Connection.php on line 317.
 1 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 2 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 3 APPPATH\Models\PurchaseReportModel.php(269): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 4 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 5 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 6 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 7 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 8 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 9 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
10 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 12:12:23 --> [Caused by] mysqli_sql_exception: Unknown column 'e.tour_plan_ref_id' in 'on clause'
in SYSTEMPATH\Database\MySQLi\Connection.php on line 312.
 1 SYSTEMPATH\Database\MySQLi\Connection.php(312): mysqli->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ', 0)
 2 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 3 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 4 APPPATH\Models\PurchaseReportModel.php(269): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 5 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 6 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 7 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 8 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2025-06-16 12:12:47 --> mysqli_sql_exception: Unknown column 'e.tour_plan_ref_id' in 'on clause' in C:\wamp64\www\khm\system\Database\MySQLi\Connection.php:312
Stack trace:
#0 C:\wamp64\www\khm\system\Database\MySQLi\Connection.php(312): mysqli->query('\r\n            S...', 0)
#1 C:\wamp64\www\khm\system\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('\r\n            S...')
#2 C:\wamp64\www\khm\system\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('\r\n            S...')
#3 C:\wamp64\www\khm\app\Models\PurchaseReportModel.php(269): CodeIgniter\Database\BaseConnection->query('\r\n            S...')
#4 C:\wamp64\www\khm\app\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
#5 C:\wamp64\www\khm\system\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
#6 C:\wamp64\www\khm\system\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
#7 C:\wamp64\www\khm\system\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#8 C:\wamp64\www\khm\system\Boot.php(334): CodeIgniter\CodeIgniter->run()
#9 C:\wamp64\www\khm\system\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#10 C:\wamp64\www\khm\public\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#11 {main}
CRITICAL - 2025-06-16 12:12:47 --> CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'e.tour_plan_ref_id' in 'on clause'
[Method: GET, Route: PurchaseReport]
in SYSTEMPATH\Database\BaseConnection.php on line 688.
 1 APPPATH\Models\PurchaseReportModel.php(269): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 2 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 3 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 4 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 5 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 6 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 7 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
 8 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 12:12:47 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'e.tour_plan_ref_id' in 'on clause'
in SYSTEMPATH\Database\MySQLi\Connection.php on line 317.
 1 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 2 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 3 APPPATH\Models\PurchaseReportModel.php(269): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 4 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 5 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 6 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 7 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 8 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 9 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
10 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 12:12:47 --> [Caused by] mysqli_sql_exception: Unknown column 'e.tour_plan_ref_id' in 'on clause'
in SYSTEMPATH\Database\MySQLi\Connection.php on line 312.
 1 SYSTEMPATH\Database\MySQLi\Connection.php(312): mysqli->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ', 0)
 2 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 3 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 4 APPPATH\Models\PurchaseReportModel.php(269): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 5 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 6 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 7 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 8 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
ERROR - 2025-06-16 12:15:13 --> mysqli_sql_exception: Unknown column 'e.tour_plan_ref_id' in 'on clause' in C:\wamp64\www\khm\system\Database\MySQLi\Connection.php:312
Stack trace:
#0 C:\wamp64\www\khm\system\Database\MySQLi\Connection.php(312): mysqli->query('\r\n            S...', 0)
#1 C:\wamp64\www\khm\system\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('\r\n            S...')
#2 C:\wamp64\www\khm\system\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('\r\n            S...')
#3 C:\wamp64\www\khm\app\Models\PurchaseReportModel.php(269): CodeIgniter\Database\BaseConnection->query('\r\n            S...')
#4 C:\wamp64\www\khm\app\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
#5 C:\wamp64\www\khm\system\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
#6 C:\wamp64\www\khm\system\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
#7 C:\wamp64\www\khm\system\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(NULL, Object(Config\Cache), false)
#8 C:\wamp64\www\khm\system\Boot.php(334): CodeIgniter\CodeIgniter->run()
#9 C:\wamp64\www\khm\system\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
#10 C:\wamp64\www\khm\public\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
#11 {main}
CRITICAL - 2025-06-16 12:15:13 --> CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'e.tour_plan_ref_id' in 'on clause'
[Method: GET, Route: PurchaseReport]
in SYSTEMPATH\Database\BaseConnection.php on line 688.
 1 APPPATH\Models\PurchaseReportModel.php(269): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 2 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 3 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 4 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 5 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 6 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 7 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
 8 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 12:15:13 --> [Caused by] CodeIgniter\Database\Exceptions\DatabaseException: Unknown column 'e.tour_plan_ref_id' in 'on clause'
in SYSTEMPATH\Database\MySQLi\Connection.php on line 317.
 1 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 2 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 3 APPPATH\Models\PurchaseReportModel.php(269): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 4 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 5 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 6 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 7 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 8 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
 9 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
10 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
CRITICAL - 2025-06-16 12:15:13 --> [Caused by] mysqli_sql_exception: Unknown column 'e.tour_plan_ref_id' in 'on clause'
in SYSTEMPATH\Database\MySQLi\Connection.php on line 312.
 1 SYSTEMPATH\Database\MySQLi\Connection.php(312): mysqli->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ', 0)
 2 SYSTEMPATH\Database\BaseConnection.php(734): CodeIgniter\Database\MySQLi\Connection->execute('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 3 SYSTEMPATH\Database\BaseConnection.php(648): CodeIgniter\Database\BaseConnection->simpleQuery('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 4 APPPATH\Models\PurchaseReportModel.php(269): CodeIgniter\Database\BaseConnection->query('
            SELECT
                base.*,

                (
                  SELECT COALESCE(tr.tax_rate_percent, 0)
                  FROM khm_obj_tax_rate AS tr
                  WHERE
                    base.total_value BETWEEN tr.applicable_hotel_range_from
                                         AND tr.applicable_hotel_range_to
                    AND tr.deleted = 0
                  LIMIT 1
                ) AS tax_rate_percent

            FROM
                ( SELECT DISTINCT `h`.`ref_no`, `h`.`enquiry_header_id`, `h`.`object_id`, `h`.`guest_entity_id`, `h`.`agent_entity_id`, `h`.`employee_entity_id`, `h`.`enq_added_date`, `h`.`enq_type_id`, `h`.`is_active` AS `header_active`, `om`.`object_name`, `ge`.`entity_name` AS `guest_name`, `ae`.`entity_name` AS `agent_name`, `ee`.`entity_name` AS `employee_name`, `d`.`enquiry_details_id`, `d`.`date_of_tour_start`, `d`.`total_no_of_pax`, `d`.`is_active` AS `details_active`, `t`.`check_in_date`, `t`.`check_out_date`, `t`.`is_active` AS `tour_active`, `lmg`.`geog_name`, `t`.`no_of_days`, `e`.`is_active` AS `extension_active`, `e`.`tpc`, `hkom`.`object_name` AS `hotel_name`, `attriagent`.`entity_attr_value` AS `agent_gstn`, `gg`.`geog_name` AS `agent_state`, `em4`.`entity_name` AS `transporter_name`, `koei`.`tour_date`, `koei`.`itinerary_details_id`, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 6 
                       AND icd.room_type_id = 2 
                        THEN icd.tariff * COALESCE(koei.double_room, 0)
                      WHEN icd.cost_component_id = 6
                       AND icd.room_type_id = 1
                        THEN icd.tariff * COALESCE(koei.single_room, 0)
                      WHEN icd.cost_component_id = 9
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.extra_bed, 0)
                      WHEN icd.cost_component_id = 12
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_with_bed, 0)
                      WHEN icd.cost_component_id = 15
                       AND icd.room_type_id = 2
                        THEN icd.tariff * COALESCE(koei.child_without_bed, 0)
                      ELSE 0
                    END
                  ),
                  0
                ) AS total_value, COALESCE(
                  SUM(
                    CASE
                      WHEN icd.cost_component_id = 19
                       AND icd.room_type_id = 1
                        THEN icd.tariff
                      ELSE 0
                    END
                  ),
                  0
                ) AS extra_cost
FROM `khm_obj_enquiry_header` AS `h`
LEFT JOIN `khm_obj_enquiry_edit_request` AS `eer` ON `eer`.`enquiry_header_id`=`h`.`enquiry_header_id`
LEFT JOIN `khm_obj_transport_follow_up` AS `tf` ON `tf`.`enquiry_header_id` = `h`.`enquiry_header_id`
LEFT JOIN `khm_entity_mst` AS `em4` ON `em4`.`entity_id` = `tf`.`transporter_id`
LEFT JOIN `khm_obj_enquiry_details` AS `d` ON `d`.`enquiry_details_id` = `e`.`enquiry_ref_id`
LEFT JOIN `khm_obj_enquiry_tour_details` AS `t` ON `t`.`tour_details_id` = `e`.`tour_plan_ref_id`
LEFT JOIN `khm_obj_enquiry_itinerary_details` AS `koei` ON `koei`.`tour_details_id` = `t`.`tour_details_id`
LEFT JOIN `khm_obj_hotel` AS `koh` ON `koh`.`hotel_id` = `koei`.`hotel_id`
LEFT JOIN `khm_obj_mst` AS `hkom` ON `hkom`.`object_id` = `koh`.`object_id`
LEFT JOIN `khm_loc_mst_geography` AS `lmg` ON `lmg`.`geog_id` = `hkom`.`object_location_id`
LEFT JOIN `khm_obj_enquiry_detail_extensions` AS `e` ON `e`.`enquiry_detail_details_id` = `eer`.`cs_confirmed_id`
LEFT JOIN `khm_obj_mst` AS `om` ON `om`.`object_id` = `h`.`object_id`
LEFT JOIN `khm_entity_mst` AS `ge` ON `ge`.`entity_id` = `h`.`guest_entity_id`
LEFT JOIN `khm_entity_mst` AS `ae` ON `ae`.`entity_id` = `h`.`agent_entity_id`
LEFT JOIN `khm_entity_mst` AS `ee` ON `ee`.`entity_id` = `h`.`employee_entity_id`
LEFT JOIN `khm_entity_attribute` AS `attr` ON `attr`.`entity_id` = `h`.`agent_entity_id` AND `attr`.`entity_class_attr_id` = 1978
LEFT JOIN `khm_entity_attribute` AS `attriagent` ON `attriagent`.`entity_id` = `h`.`agent_entity_id` AND `attriagent`.`entity_class_attr_id` = 1970
LEFT JOIN `khm_loc_mst_geography` AS `gg` ON `gg`.`geog_id`=`attr`.`entity_attr_value`
LEFT JOIN `khm_obj_itinerary_costing_details` AS `icd` ON `icd`.`itinerary_details_id` = `koei`.`itinerary_details_id`
WHERE `eer`.`is_active` = 1
AND `h`.`is_active` = 1
AND `d`.`is_active` = 1
AND `t`.`is_active` = 1
AND `koei`.`is_active` = 1
AND `icd`.`is_active` = 1
AND `e`.`is_active` = 1
GROUP BY `t`.`tour_details_id`
ORDER BY `d`.`date_of_tour_start` DESC ) AS base
        ')
 5 APPPATH\Controllers\PurchaseReport.php(76): App\Models\PurchaseReportModel->getSourceReport()
 6 SYSTEMPATH\CodeIgniter.php(933): App\Controllers\PurchaseReport->index()
 7 SYSTEMPATH\CodeIgniter.php(509): CodeIgniter\CodeIgniter->runController(Object(App\Controllers\PurchaseReport))
 8 SYSTEMPATH\CodeIgniter.php(355): CodeIgniter\CodeIgniter->handleRequest(null, Object(Config\Cache), false)
 9 SYSTEMPATH\Boot.php(334): CodeIgniter\CodeIgniter->run()
10 SYSTEMPATH\Boot.php(67): CodeIgniter\Boot::runCodeIgniter(Object(CodeIgniter\CodeIgniter))
11 FCPATH\index.php(56): CodeIgniter\Boot::bootWeb(Object(Config\Paths))
